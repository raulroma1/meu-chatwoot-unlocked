version: '3'\nservices:\n  rails:\n    image: 'harbor.fazer.ai/chatwoot/fazer-ai/chatwoot-pro:v4.11.0-fazer-ai-pro.38'\n    pull_policy: always\n    volumes:\n      - 'storage:/app/storage'\n      - '/data/coolify/custom_configs/features_helper.rb:/app/app/helpers/super_admin/features_helper.rb'\n      - '/data/coolify/custom_configs/fazer_ai_hub.rb:/app/fazer_ai/lib/fazer_ai_hub.rb'\n    depends_on:\n      - postgres\n      - redis\n    environment:\n      - SERVICE_URL_RAILS\n      - NODE_ENV=production\n      - RAILS_ENV=production\n      - INSTALLATION_ENV=docker\n      - DEFAULT_LOCALE=pt_BR\n      - 'FRONTEND_URL=${SERVICE_URL_RAILS}'\n      - 'INTERNAL_HOST_URL=http://rails:3000'\n      - POSTGRES_HOST=postgres\n      - POSTGRES_PORT=5432\n      - 'POSTGRES_USERNAME=${SERVICE_USER_POSTGRES}'\n      - 'POSTGRES_PASSWORD=${SERVICE_PASSWORD_POSTGRES}'\n      - 'POSTGRES_DATABASE=${POSTGRES_DB:-chatwoot_production}'\n      - 'SECRET_KEY_BASE=${SERVICE_PASSWORD_64_SECRETKEYBASE}'\n      - 'REDIS_URL=redis://redis:6379'\n      - 'REDIS_PASSWORD=${SERVICE_PASSWORD_REDIS}'\n      - 'BAILEYS_PROVIDER_DEFAULT_CLIENT_NAME=${BAILEYS_PROVIDER_DEFAULT_CLIENT_NAME:-Chatwoot}'\n      - 'BAILEYS_PROVIDER_DEFAULT_URL=http://baileys-api:3025'\n      - 'BAILEYS_PROVIDER_DEFAULT_API_KEY=${SERVICE_PASSWORD_64_DEFAULTAPIKEY}'\n      - BAILEYS_PROVIDER_USE_INTERNAL_HOST_URL=true\n      - 'MAILER_SENDER_EMAIL=${MAILER_SENDER_EMAIL}'\n      - 'RESEND_API_KEY=${RESEND_API_KEY}'\n      - FAZER_AI_API_KEY=null\n      - FAZER_AI_SUBSCRIPTION_ID=null\n    entrypoint: docker/entrypoints/rails.sh\n    command:\n      - bundle\n      - exec\n      - rails\n      - s\n      - '-p'\n      - '3000'\n      - '-b'\n      - 0.0.0.0\n    restart: always\n    post_start:\n      -\n        command:\n          - sh\n          - '-c'\n          - 'bundle exec rails db:chatwoot_prepare && bundle exec rails branding:update && if [ -n "$${BRAND_ASSETS_URL}" ]; then deployment/extract_brand_assets.sh "$${BRAND_ASSETS_URL}"; fi'\n    healthcheck:\n      test:\n        - CMD-SHELL\n        - 'wget -qO- --header="Accept: text/html" http://127.0.0.1:3000/'\n      interval: 60s\n      timeout: 20s\n      retries: 10\n  sidekiq:\n    image: 'harbor.fazer.ai/chatwoot/fazer-ai/chatwoot-pro:v4.11.0-fazer-ai-pro.38'\n    pull_policy: always\n    volumes:\n      - 'storage:/app/storage'\n      - '/data/coolify/custom_configs/features_helper.rb:/app/app/helpers/super_admin/features_helper.rb'\n      - '/data/coolify/custom_configs/fazer_ai_hub.rb:/app/fazer_ai/lib/fazer_ai_hub.rb'\n    depends_on:\n      - postgres\n      - redis\n    environment:\n      - NODE_ENV=production\n      - RAILS_ENV=production\n      - INSTALLATION_ENV=docker\n      - DEFAULT_LOCALE=pt_BR\n      - 'FRONTEND_URL=${SERVICE_URL_RAILS}'\n      - 'INTERNAL_HOST_URL=http://rails:3000'\n      - POSTGRES_HOST=postgres\n      - POSTGRES_PORT=5432\n      - 'POSTGRES_USERNAME=${SERVICE_USER_POSTGRES}'\n      - 'POSTGRES_PASSWORD=${SERVICE_PASSWORD_POSTGRES}'\n      - 'POSTGRES_DATABASE=${POSTGRES_DB:-chatwoot_production}'\n      - 'SECRET_KEY_BASE=${SERVICE_PASSWORD_64_SECRETKEYBASE}'\n      - 'REDIS_URL=redis://redis:6379'\n      - 'REDIS_PASSWORD=${SERVICE_PASSWORD_REDIS}'\n      - 'BAILEYS_PROVIDER_DEFAULT_CLIENT_NAME=${BAILEYS_PROVIDER_DEFAULT_CLIENT_NAME:-Chatwoot}'\n      - 'BAILEYS_PROVIDER_DEFAULT_URL=http://baileys-api:3025'\n      - 'BAILEYS_PROVIDER_DEFAULT_API_KEY=${SERVICE_PASSWORD_64_DEFAULTAPIKEY}'\n      - BAILEYS_PROVIDER_USE_INTERNAL_HOST_URL=true\n      - 'MAILER_SENDER_EMAIL=${MAILER_SENDER_EMAIL}'\n      - 'RESEND_API_KEY=${RESEND_API_KEY}'\n      - FAZER_AI_API_KEY=null\n      - FAZER_AI_SUBSCRIPTION_ID=null\n    command:\n      - bundle\n      - exec\n      - sidekiq\n      - '-C'\n      - config/sidekiq.yml\n    restart: always\n    healthcheck:\n      test:\n        - CMD-SHELL\n        - 'ps aux | grep [s]idekiq'\n      interval: 20s\n      timeout: 20s\n      retries: 10\n  postgres:\n    image: 'ghcr.io/fazer-ai/postgres-16-pgvector:latest'\n    restart: always\n    volumes:\n      - 'postgres:/var/lib/postgresql/data'\n    environment:\n      - 'POSTGRES_DB=${POSTGRES_DB:-chatwoot_production}'\n      - 'POSTGRES_USER=${SERVICE_USER_POSTGRES}'\n      - 'POSTGRES_PASSWORD=${SERVICE_PASSWORD_POSTGRES}'\n    healthcheck:\n      test:\n        - CMD-SHELL\n        - 'pg_isready -h localhost -p 5432 -U $${POSTGRES_USER} -d $${POSTGRES_DB}'\n      interval: 20s\n      timeout: 20s\n      retries: 10\n  redis:\n    image: 'redis:alpine'\n    restart: always\n    command:\n      - sh\n      - '-c'\n      - 'redis-server --requirepass "${SERVICE_PASSWORD_REDIS}"'\n    volumes:\n      - 'redis:/data'\n    environment:\n      - 'REDIS_PASSWORD=${SERVICE_PASSWORD_REDIS}'\n    healthcheck:\n      test:\n        - CMD-SHELL\n        - 'redis-cli -h localhost -p 6379 -a $${REDIS_PASSWORD} ping'\n      interval: 20s\n      timeout: 20s\n      retries: 10\n  baileys-api:\n    image: 'ghcr.io/fazer-ai/baileys-api:latest'\n    pull_policy: always\n    volumes:\n      - 'storage:/app/storage'\n    environment:\n      - NODE_ENV=production\n      - 'REDIS_URL=redis://redis:6379'\n      - 'REDIS_PASSWORD=${SERVICE_PASSWORD_REDIS}'\n      - 'LOG_LEVEL=${LOG_LEVEL:-debug}'\n      - 'BAILEYS_LOG_LEVEL=${BAILEYS_LOG_LEVEL:-error}'\n      - 'BAILEYS_PROVIDER_DEFAULT_API_KEY=${SERVICE_PASSWORD_64_DEFAULTAPIKEY}'\n    command:\n      - sh\n      - '-c'\n      - 'bun manage-api-keys create user ${SERVICE_PASSWORD_64_DEFAULTAPIKEY} && bun start'\n    restart: always\n    healthcheck:\n      test:\n        - CMD-SHELL\n        - 'wget -qO- http://localhost:3025/status'\n      interval: 20s\n      timeout: 20s\n      retries: 10\n